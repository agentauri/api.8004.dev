# Classification

The Classification API provides OASF (Open Agent Skill Framework) classification for AI agents. Classifications are generated by LLM analysis of agent capabilities.

## Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/v1/agents/:agentId/classify` | Get agent classification |
| POST | `/api/v1/agents/:agentId/classify` | Request new classification |

## Get Classification

```
GET /api/v1/agents/:agentId/classify
```

Retrieve the OASF classification for an agent, including skills and domains.

### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `agentId` | string | Agent ID in format `chainId:tokenId` |

### Example Request

```bash
curl "https://api.8004.dev/api/v1/agents/11155111:1234/classify" \
  -H "X-API-Key: your-api-key"
```

### Example Response (Classified)

```json
{
  "success": true,
  "data": {
    "skills": [
      { "slug": "code_generation", "name": "Code Generation" },
      { "slug": "code_review", "name": "Code Review" },
      { "slug": "debugging", "name": "Debugging" }
    ],
    "domains": [
      { "slug": "technology", "name": "Technology" },
      { "slug": "software_development", "name": "Software Development" }
    ],
    "confidence": 0.95,
    "modelVersion": "gemini-2.0-flash",
    "classifiedAt": "2024-01-03T12:00:00.000Z"
  }
}
```

### Example Response (Pending)

```json
{
  "success": true,
  "status": "pending",
  "estimatedTime": 30
}
```

HTTP Status: `202 Accepted`

### Example Response (Not Found)

```json
{
  "success": false,
  "error": "Classification not found",
  "code": "NOT_FOUND",
  "requestId": "abc123"
}
```

HTTP Status: `404 Not Found`

---

## Request Classification

```
POST /api/v1/agents/:agentId/classify
```

Request a new OASF classification for an agent. Classifications are processed asynchronously.

### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `agentId` | string | Agent ID in format `chainId:tokenId` |

### Request Body

```json
{
  "force": false
}
```

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `force` | boolean | false | Force re-classification even if already classified |

### Example Request

```bash
curl -X POST "https://api.8004.dev/api/v1/agents/11155111:1234/classify" \
  -H "X-API-Key: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{"force": false}'
```

### Example Response (Queued)

```json
{
  "success": true,
  "status": "queued",
  "agentId": "11155111:1234"
}
```

HTTP Status: `202 Accepted`

### Example Response (Already Classified)

```json
{
  "success": true,
  "status": "already_classified",
  "agentId": "11155111:1234"
}
```

### Example Response (Already Processing)

```json
{
  "success": true,
  "status": "processing",
  "estimatedTime": 30
}
```

HTTP Status: `202 Accepted`

---

## Classification Process

1. **Queue**: Classification request is queued for processing
2. **Fetch**: Agent metadata is fetched from IPFS and blockchain
3. **Analyze**: LLM analyzes agent description, tools, and skills
4. **Classify**: OASF skills and domains are assigned
5. **Store**: Results are cached in the database

### Classification Sources

| Source | Priority | Description |
|--------|----------|-------------|
| `creator-defined` | 1 (highest) | OASF from agent's metadata file |
| `llm-classification` | 2 | LLM-generated classification |
| `none` | 3 (lowest) | No classification available |

When retrieving agent details, the `oasfSource` field indicates which source was used.

---

## OASF Taxonomy

Classifications use the OASF (Open Agent Skill Framework) taxonomy:

- **136 Skills**: Capabilities like `code_generation`, `data_analysis`, `translation`
- **204 Domains**: Areas like `technology`, `healthcare`, `finance`

See the [Taxonomy endpoint](/api/taxonomy) to explore available skills and domains.

---

## Rate Limiting

Classification endpoints have stricter rate limits due to LLM processing costs:

| Tier | Limit |
|------|-------|
| With API Key | 100 req/min |

---

## Error Responses

| Status | Code | Description |
|--------|------|-------------|
| 400 | `VALIDATION_ERROR` | Invalid agent ID format |
| 401 | `UNAUTHORIZED` | Missing or invalid API key |
| 404 | `NOT_FOUND` | Classification not found |
| 429 | `RATE_LIMIT_EXCEEDED` | Too many requests |

---

## Automatic Classification

Classifications are automatically triggered when:

1. An agent is returned in search results without classification
2. An agent detail is fetched without classification
3. Up to 10 agents per request are auto-queued

This ensures the classification database is continuously populated without manual intervention.
