# 8004-backend E2E Testing Configuration
# Uses mock services for deterministic testing
# Usage: wrangler dev --config wrangler.e2e.toml

name = "8004-backend-e2e"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Development settings for E2E testing
[dev]
port = 8788
local_protocol = "http"

# Environment variables for E2E testing
[vars]
ENVIRONMENT = "e2e-test"
# Enable mock services for deterministic testing
MOCK_EXTERNAL_SERVICES = "true"
# Disable caching during tests
CACHE_TTL = "0"
# Rate limiting (relaxed for testing)
RATE_LIMIT_RPM = "1000"
# Classification models (not used in mock mode)
CLASSIFICATION_MODEL = "gemini-2.0-flash"
FALLBACK_MODEL = "claude-3-haiku-20240307"

# D1 Database binding (use local SQLite for E2E)
[[d1_databases]]
binding = "DB"
database_name = "8004-backend-db-e2e"
database_id = "local"

# KV Namespace binding (use local KV for E2E)
[[kv_namespaces]]
binding = "CACHE"
id = "e2e-cache-namespace"

# Queue producer binding (mock queue for E2E)
[[queues.producers]]
binding = "CLASSIFICATION_QUEUE"
queue = "classification-jobs-e2e"

# Queue consumer configuration (disabled for E2E)
[[queues.consumers]]
queue = "classification-jobs-e2e"
max_batch_size = 1
max_batch_timeout = 1
max_retries = 0
